<!DOCTYPE html>
<html lang="uz">

<head>
  <meta charset="UTF-8">
  <title>PS3 Timer</title>

  <style>
    /* === STYLE O‚ÄòZGARMAGAN === */
    body {
      font-family: Arial, sans-serif;
      margin: 0 auto;
      padding-top: 15px;
      width: 750px;
      max-width: 100%;
      display: flex;
      text-align: center;
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    }

    #pasdagi {
      position: fixed;
      background: orange;
      top: 20px;
      left: 20px;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 50px;
      z-index: 10000;
    }

    p {
      font-size: 45px;
      margin: 45px 0;
      font-weight: 700;
      transform: scaleY(1.7);
    }

    h3 {
      font-weight: 800;
      font-size: 45px;
      margin: 10px 0 0 0;
      transform: scaleY(1.6);
      display: inline-block;
    }

    #logTab {
      display: none;
      position: fixed;
      width: 350px;
      inset: 0;
      background: #f5f7fb;
      padding: 16px;
      overflow-y: auto;
      z-index: 9999;
    }

    #logList li {
      background: #fff;
      margin-bottom: 10px;
      padding: 12px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, .08);
      font-size: 24px;
    }

    .ps {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .timer {
      background: #fff;
      padding: 15px;
      width: 550px;
      height: 920px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(13, 71, 161, 0.15);
      border-top: 6px solid #1976d2;
    }

    .time {
      font-size: 28px;
      font-weight: 900;
      transform: scaleY(2);
      display: inline-block;
    }

    button {
      width: 100%;
      height: 6rem;
      margin-top: 6px;
      border-radius: 8px;
      font-size: 36px;
      font-weight: 800;
      border: none;
      cursor: pointer;
    }

    .tarif-btn {
      background: #e3f2fd;
    }

    .tarif-btn.active {
      background: #1976d2;
      color: #fff;
    }

    .start-btn {
      background: #19d238;
      color: #fff;
    }

    .stop-btn {
      background: #eb2121;
      color: #fff;
    }

    .reset-btn {
      background: rgb(239, 8, 162);
      color: #fff;
    }
  </style>
</head>

<body>

  <div id="logTab">
    <h2>üìë Hisobotlar</h2>
    <button onclick="closeLogTab()">‚ùå Yopish</button>
    <button onclick="clearLogs()" style="background:red;color:white;">üóë Tozalash</button>
    <ul id="logList"></ul>
  </div>

  <div class="ps" id="psArea"></div>

  <div id="pasdagi" onclick="openLogTab()">üìë</div>

  <script>
    /************ STOLLARNI YARATISH (8 TA) ************/
    const psArea = document.getElementById("psArea");
    for (let i = 1; i <= 8; i++) {
      psArea.innerHTML += `
  <div class="timer" data-stol="${i}-Stol">
    <h3>${i}-Stol</h3>
    <p>Vaqt: <span class="time">00:00:00:000</span></p>
    <p>Tarif: <span class="current-tarif">Tanlanmagan</span></p>
    <p>Summa: <span class="cost">0</span> so'm</p>

    <button class="tarif-btn" onclick="setTarif(this,20000,'2 ta pult')">
      2-pult 
    </button>

    <button class="tarif-btn" onclick="setTarif(this,24000,'3‚Äì4 ta pult')">
      3/4-pult
    </button>

    <button class="start-btn" onclick="startTimer(this)">Start</button>
    <button class="stop-btn" onclick="stopTimer(this)">Stop</button>
    <button class="reset-btn" onclick="resetTimer(this)">Reset</button>
  </div>`;
    }

    /************ TIMER LOGIC ************/
    const timers = new Map();
    const LOG_KEY = "ps_logs";

    function setTarif(btn, rate, name) {
      const box = btn.closest(".timer");
      box.rate = rate;
      box.tarifName = name;
      box.querySelector(".current-tarif").innerText =
        `${name} ‚Äì ${rate.toLocaleString()} so'm`;

      box.querySelectorAll(".tarif-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    }

    function startTimer(btn) {
      const box = btn.closest(".timer");
      if (!box.rate) return alert("Avval tarif tanlang!");
      if (timers.has(box)) return;

      box.startTime = Date.now();
      timers.set(box, setInterval(() => drawUI(box), 50));
    }

    function stopTimer(btn) {
      const box = btn.closest(".timer");
      if (!timers.has(box)) return;

      clearInterval(timers.get(box));
      timers.delete(box);

      const elapsed = Date.now() - box.startTime;
      const cost = Math.round(elapsed / 3600000 * box.rate);

      saveLog({
        stol: box.dataset.stol,
        tarif: box.tarifName,
        vaqt: msToTime(elapsed),
        summa: cost
      });
    }

    function resetTimer(btn) {
      const box = btn.closest(".timer");
      if (timers.has(box)) {
        clearInterval(timers.get(box));
        timers.delete(box);
      }
      box.querySelector(".time").innerText = "00:00:00:000";
      box.querySelector(".cost").innerText = "0";
      box.querySelector(".current-tarif").innerText = "Tanlanmagan";
      box.querySelectorAll(".tarif-btn").forEach(b => b.classList.remove("active"));
    }

    function drawUI(box) {
      const ms = Date.now() - box.startTime;
      const h = Math.floor(ms / 3600000);
      const m = Math.floor(ms / 60000) % 60;
      const s = Math.floor(ms / 1000) % 60;
      const mi = ms % 1000;

      box.querySelector(".time").innerText =
        `${String(h).padStart(2, "0")}:${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}:${String(mi).padStart(3, "0")}`;

      box.querySelector(".cost").innerText =
        Math.round(ms / 3600000 * box.rate).toLocaleString();
    }

    /************ LOG ************/
    function saveLog(log) {
      const logs = JSON.parse(localStorage.getItem(LOG_KEY) || "[]");
      logs.unshift({ ...log, sana: new Date().toLocaleString() });
      localStorage.setItem(LOG_KEY, JSON.stringify(logs));
      renderLogs();
    }

    function renderLogs() {
      const list = document.getElementById("logList");
      const logs = JSON.parse(localStorage.getItem(LOG_KEY) || "[]");
      list.innerHTML = logs.length
        ? logs.map(l => `
      <li>
        <b>${l.stol}</b><br>
        Tarif: ${l.tarif}<br>
        Vaqt: ${l.vaqt}<br>
        Summa: <b>${l.summa.toLocaleString()} so'm</b><br>
        <small>${l.sana}</small>
      </li>`).join("")
        : "<li>Hozircha hisobot yo‚Äòq</li>";
    }

    function msToTime(ms) {
      const h = Math.floor(ms / 3600000);
      const m = Math.floor(ms / 60000) % 60;
      const s = Math.floor(ms / 1000) % 60;
      return `${h}:${m}:${s}`;
    }

    function openLogTab() {
      document.getElementById("logTab").style.display = "block";
      renderLogs();
    }
    function closeLogTab() {
      document.getElementById("logTab").style.display = "none";
    }
    function clearLogs() {
      if (confirm("Hammasi o‚Äòchirilsinmi?")) {
        localStorage.removeItem(LOG_KEY);
        renderLogs();
      }
    }
  </script>

</body>

</html>
